<<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Wallet Verification</title>
  </head>
  <body>
    <h1>Connect Wallet to Verify</h1>
    <button id="connectButton">Connect Wallet</button>
    <p id="status"></p>

    <script src="https://unpkg.com/@solana/wallet-adapter-wallets"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-base"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-wallets/dist/wallets.umd.js"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-react-ui/styles.css"></script>
    <script type="module">
      import {
        Connection,
        clusterApiUrl,
        PublicKey
      } from "https://cdn.jsdelivr.net/npm/@solana/web3.js@1.73.3/+esm";

      document.getElementById("connectButton").onclick = async () => {
        try {
          const provider = window.phantom?.solana;
          if (!provider || !provider.isPhantom) {
            alert("Phantom wallet not found!");
            return;
          }

          const resp = await provider.connect();
          const walletAddress = resp.publicKey.toString();
          const tg = new URLSearchParams(window.location.search).get("tg");

          const res = await fetch("/verify", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ wallet: walletAddress, tg }),
          });

          const statusText = document.getElementById("status");
          if (res.ok) {
            statusText.innerHTML = "✅ Wallet verified!";
          } else {
            const error = await res.json();
            statusText.innerHTML = "❌ " + (error.message || "Verification failed.");
          }
        } catch (err) {
          console.error("Wallet connection error:", err);
          document.getElementById("status").innerHTML = "❌ Connection failed.";
        }
      };
    </script>
  </body>
</html>
