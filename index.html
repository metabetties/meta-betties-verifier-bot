<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Meta Betties Verifier</title>
  <script type="module">
    import {
      ConnectionProvider,
      WalletProvider,
      useWallet
    } from "https://cdn.jsdelivr.net/npm/@solana/wallet-adapter-react@0.15.21/lib/index.mjs";

    import {
      WalletModalProvider,
      WalletMultiButton
    } from "https://cdn.jsdelivr.net/npm/@solana/wallet-adapter-react-ui@0.9.20/lib/index.mjs";

    import {
      PhantomWalletAdapter
    } from "https://cdn.jsdelivr.net/npm/@solana/wallet-adapter-wallets@0.20.23/lib/esm/phantom/adapter.mjs";

    import {
      clusterApiUrl
    } from "https://cdn.jsdelivr.net/npm/@solana/web3.js@1.88.2/lib/index.browser.mjs";

    const App = () => {
      const wallet = useWallet();

      const handleVerify = async () => {
        const tg = new URLSearchParams(window.location.search).get('tg');
        if (!wallet.connected || !tg) return;

        const response = await fetch("https://meta-betties-verifier-bot-production.up.railway.app/verify", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            wallet: wallet.publicKey.toString(),
            tg: tg
          })
        });

        const result = await response.json();
        const success = result.success;

        const status = document.getElementById("status");
        status.innerText = success ? "✅ Verification complete! Check Telegram." : "❌ Verification failed.";
        status.style.color = success ? "green" : "red";
      };

      if (!wallet.connected) {
        return (
          <>
            <h2>Connect Wallet to Verify</h2>
            <WalletMultiButton />
            <p id="status"></p>
          </>
        );
      }

      return (
        <>
          <h2>✅ Wallet connected: {wallet.publicKey.toString()}</h2>
          <button onclick={handleVerify}>Verify NFT Ownership</button>
          <p id="status"></p>
        </>
      );
    };

    const wallets = [new PhantomWalletAdapter()];
    const network = clusterApiUrl("mainnet-beta");

    const Root = () => (
      <ConnectionProvider endpoint={network}>
        <WalletProvider wallets={wallets} autoConnect>
          <WalletModalProvider>
            <App />
          </WalletModalProvider>
        </WalletProvider>
      </ConnectionProvider>
    );

    const mount = document.getElementById("root");
    import("https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js").then(React => {
      import("https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js").then(ReactDOM => {
        ReactDOM.createRoot(mount).render(React.createElement(Root));
      });
    });
  </script>

  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@solana/wallet-adapter-react-ui@0.9.20/styles.css"
  />
</head>
<body>
  <div id="root" style="font-family: sans-serif; padding: 2rem;"></div>
</body>
</html>


