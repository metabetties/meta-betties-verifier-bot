<!DOCTYPE html>
<html>
<head>
  <title>Connect Wallet to Verify</title>
</head>
<body>
  <h1>Connect Wallet to Verify</h1>
  <button id="connectWallet">Connect Wallet</button>
  <p id="walletStatus"></p>

  <script type="module">
    import {
      Connection,
      clusterApiUrl,
      PublicKey
    } from "https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.2/+esm";

    async function connectWallet() {
      const statusEl = document.getElementById("walletStatus");

      try {
        if (!window.solana || !window.solana.isPhantom) {
          statusEl.innerHTML = "‚ùå Phantom wallet not found.";
          return;
        }

        const resp = await window.solana.connect();
        const walletAddress = resp.publicKey.toString();
        statusEl.innerHTML = `‚úÖ Connected: ${walletAddress}`;

        // Extract Telegram ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const telegramId = urlParams.get('tg');

        // Send to backend for verification
        const verifyUrl = "https://meta-betties-verifier-bot-production.up.railway.app/verify";
        const result = await fetch(verifyUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            walletAddress,
            telegramId
          }),
        });

        const json = await result.json();

        if (json.success) {
          statusEl.innerHTML += "<br/>üéâ Verification successful!";
        } else {
          statusEl.innerHTML += "<br/>‚ùå Verification failed.";
        }

      } catch (err) {
        statusEl.innerHTML = `‚ùå Wallet connection failed.<br/>${err.message}`;
      }
    }

    document.getElementById("connectWallet").addEventListener("click", connectWallet);
  </script>
</body>
</html>

